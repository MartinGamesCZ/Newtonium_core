// @bun
import{dlopen as p,FFIType as e}from"bun:ffi";function h(t){const{symbols:i}=p(t,{initialize:{args:[],returns:e.bool},run:{args:[],returns:e.void},create_window:{args:[e.cstring,e.cstring,e.cstring,e.function],returns:e.ptr},create_element:{args:[e.ptr,e.cstring,e.cstring,e.cstring],returns:e.void},append_child:{args:[e.ptr,e.cstring,e.ptr],returns:e.void},set_attribute:{args:[e.ptr,e.cstring,e.cstring,e.cstring,e.cstring],returns:e.void},add_event_listener:{args:[e.ptr,e.cstring,e.cstring,e.cstring],returns:e.void},remove_element:{args:[e.ptr,e.cstring],returns:e.void},set_styles:{args:[e.ptr,e.cstring,e.cstring],returns:e.void},get_attribute:{args:[e.ptr,e.cstring,e.cstring,e.cstring,e.cstring],returns:e.cstring}});return i}function r(t){return new Uint8Array([...new TextEncoder().encode(t),0])}import{randomUUID as _}from"crypto";function s(){return _().replaceAll("-","")}function m(t,i){return`
    .iid_${t} {
      ${Object.entries(i).filter(([,o])=>typeof o==="string").map(([o,l])=>`${o}: ${l}`).join("~ ")}
    }
  `.replace(/\n/g," ").replace(/[ ]{2,}/g," ").trim()}class d{tagName;iid;_symbols=new Map;_window;constructor(t,i,n){this.tagName=t,this.iid=i,this._window=n}style={setProperty:(t,i)=>{this.style[t]=i;const n=m(this.iid,this.style);this._window.core.set_styles(this._window.getChannelPtr(),r(this.iid),r(n))}};appendChild(t){this._window.core.append_child(this._window.getChannelPtr(),r(this.iid),r(t.iid))}setAttribute(t,i){this._window.core.set_attribute(this._window.getChannelPtr(),r(this.iid),r(this.tagName),r(t),r(i))}getAttribute(t){const i=s();this._window.element_listeners[i]=(n)=>{console.log("val",n)},this._window.core.get_attribute(this._window.getChannelPtr(),r(this.iid),r(this.tagName),r(t),r(i))}addEventListener(t,i){const n=s();return this._window.element_listeners[n]=i,this._symbols.set(t,[...this._symbols.get(t)||[],n]),this._window.core.add_event_listener(this._window.getChannelPtr(),r(this.iid),r(t),r(n)),n}removeEventListener(t){const i=this._symbols.get(t);if(!i)return;i.forEach((n)=>{this._window.element_listeners[n]=()=>{},delete this._window.element_listeners[n]})}remove(){this._window.core.remove_element(this._window.getChannelPtr(),r(this.iid)),this._window.document.deleteElement(this.iid)}}import w from"util";class a{_elements=new Map;_window;body;constructor(t){this._window=t,this.body=this._createElementWithId("view","body",!0)}createElement(t,i={}){const n=s();return this._createElementWithId(t,n,!1,i)}getElementById(t){return this._elements.get(t)?.element}_createElementWithId(t,i,n=!1,o={}){if(!n)this._window.core.create_element(this._window.getChannelPtr(),r(t),r(i),r(JSON.stringify(o)));const l=new d(t,i,this._window);return this._elements.set(i,{pointer:0,element:l}),l}deleteElement(t){this._elements.delete(t)}[w.inspect.custom](t,i){return`NewtoniumDocument {
  elements: ${this._elements.size}
}`}}import c from"path";class g{worker_path=c.join(import.meta.dirname,"../workers/runner");lib_path=c.join(import.meta.dirname,"../lib/libnewtonium"+(process.platform=="win32"?".dll":".so"));_worker;_id;_channel_ptr=-1;core=h(this.lib_path);title;icon;document;listeners={ready:[]};element_listeners={};constructor(t,i){this._worker=new Worker(this.worker_path),this._id=s(),this.title=t,this.icon=i,this.document=new a(this)}run(){this._worker.postMessage({lib_path:this.lib_path,id:this._id,title:this.title,icon:this.icon}),this._worker.onmessage=(t)=>{if(t.data.e==="close")this._worker.terminate();if(t.data.e==="ready")this._channel_ptr=t.data.channel_ptr,this._fireEvent("ready");if(t.data.e==="event"){const i=this.element_listeners[t.data.symbol_id.startsWith("!!")?t.data.iid.split("!!")[0]:t.data.symbol_id];if(!i)return;if(t.data.symbol_id.startsWith("!!")){i(t.data.iid.split("!!").slice(1).join("!!")),delete this.element_listeners[t.data.symbol_id];return}i()}}}on(t,i){if(!this.listeners[t])this.listeners[t]=[];this.listeners[t].push(i)}_fireEvent(t,...i){for(let n of this.listeners[t])n(...i)}getChannelPtr(){if(this._channel_ptr===-1)throw new Error("Window is not ready yet");return this._channel_ptr}}export{g as Window,a as Document};

//# debugId=C8272B1B7E063AA564756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2ZmaS50cyIsICIuLi9zcmMvdXRpbHMvaWQudHMiLCAiLi4vc3JjL3V0aWxzL2Nzc190cmFuc2Zvcm1lci50cyIsICIuLi9zcmMvZG9tL2VsZW1lbnQudHMiLCAiLi4vc3JjL2RvbS9kb2N1bWVudC50cyIsICIuLi9zcmMvZG9tL3dpbmRvdy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsKICAgICJpbXBvcnQgeyBkbG9wZW4sIEZGSVR5cGUgfSBmcm9tIFwiYnVuOmZmaVwiO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRkZJKHBhdGg6IHN0cmluZykge1xuICBjb25zdCB7IHN5bWJvbHMgfSA9IGRsb3BlbihwYXRoLCB7XG4gICAgaW5pdGlhbGl6ZToge1xuICAgICAgYXJnczogW10sXG4gICAgICByZXR1cm5zOiBGRklUeXBlLmJvb2wsXG4gICAgfSxcbiAgICBydW46IHtcbiAgICAgIGFyZ3M6IFtdLFxuICAgICAgcmV0dXJuczogRkZJVHlwZS52b2lkLFxuICAgIH0sXG4gICAgY3JlYXRlX3dpbmRvdzoge1xuICAgICAgYXJnczogW1xuICAgICAgICBGRklUeXBlLmNzdHJpbmcsXG4gICAgICAgIEZGSVR5cGUuY3N0cmluZyxcbiAgICAgICAgRkZJVHlwZS5jc3RyaW5nLFxuICAgICAgICBGRklUeXBlLmZ1bmN0aW9uLFxuICAgICAgXSxcbiAgICAgIHJldHVybnM6IEZGSVR5cGUucHRyLFxuICAgIH0sXG4gICAgY3JlYXRlX2VsZW1lbnQ6IHtcbiAgICAgIGFyZ3M6IFtGRklUeXBlLnB0ciwgRkZJVHlwZS5jc3RyaW5nLCBGRklUeXBlLmNzdHJpbmcsIEZGSVR5cGUuY3N0cmluZ10sXG4gICAgICByZXR1cm5zOiBGRklUeXBlLnZvaWQsXG4gICAgfSxcbiAgICBhcHBlbmRfY2hpbGQ6IHtcbiAgICAgIGFyZ3M6IFtGRklUeXBlLnB0ciwgRkZJVHlwZS5jc3RyaW5nLCBGRklUeXBlLnB0cl0sXG4gICAgICByZXR1cm5zOiBGRklUeXBlLnZvaWQsXG4gICAgfSxcbiAgICBzZXRfYXR0cmlidXRlOiB7XG4gICAgICBhcmdzOiBbXG4gICAgICAgIEZGSVR5cGUucHRyLFxuICAgICAgICBGRklUeXBlLmNzdHJpbmcsXG4gICAgICAgIEZGSVR5cGUuY3N0cmluZyxcbiAgICAgICAgRkZJVHlwZS5jc3RyaW5nLFxuICAgICAgICBGRklUeXBlLmNzdHJpbmcsXG4gICAgICBdLFxuICAgICAgcmV0dXJuczogRkZJVHlwZS52b2lkLFxuICAgIH0sXG4gICAgYWRkX2V2ZW50X2xpc3RlbmVyOiB7XG4gICAgICBhcmdzOiBbRkZJVHlwZS5wdHIsIEZGSVR5cGUuY3N0cmluZywgRkZJVHlwZS5jc3RyaW5nLCBGRklUeXBlLmNzdHJpbmddLFxuICAgICAgcmV0dXJuczogRkZJVHlwZS52b2lkLFxuICAgIH0sXG4gICAgcmVtb3ZlX2VsZW1lbnQ6IHtcbiAgICAgIGFyZ3M6IFtGRklUeXBlLnB0ciwgRkZJVHlwZS5jc3RyaW5nXSxcbiAgICAgIHJldHVybnM6IEZGSVR5cGUudm9pZCxcbiAgICB9LFxuICAgIHNldF9zdHlsZXM6IHtcbiAgICAgIGFyZ3M6IFtGRklUeXBlLnB0ciwgRkZJVHlwZS5jc3RyaW5nLCBGRklUeXBlLmNzdHJpbmddLFxuICAgICAgcmV0dXJuczogRkZJVHlwZS52b2lkLFxuICAgIH0sXG4gICAgZ2V0X2F0dHJpYnV0ZToge1xuICAgICAgYXJnczogW1xuICAgICAgICBGRklUeXBlLnB0cixcbiAgICAgICAgRkZJVHlwZS5jc3RyaW5nLFxuICAgICAgICBGRklUeXBlLmNzdHJpbmcsXG4gICAgICAgIEZGSVR5cGUuY3N0cmluZyxcbiAgICAgICAgRkZJVHlwZS5jc3RyaW5nLFxuICAgICAgXSxcbiAgICAgIHJldHVybnM6IEZGSVR5cGUuY3N0cmluZyxcbiAgICB9LFxuICB9KTtcblxuICByZXR1cm4gc3ltYm9scztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvQ1N0cmluZyhzdHI6IHN0cmluZykge1xuICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWy4uLm5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzdHIpLCAwXSk7XG59XG4iLAogICAgImltcG9ydCB7IHJhbmRvbVVVSUQgfSBmcm9tIFwiY3J5cHRvXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiByYW5kb21JZCgpIHtcbiAgcmV0dXJuIHJhbmRvbVVVSUQoKS5yZXBsYWNlQWxsKFwiLVwiLCBcIlwiKTtcbn1cbiIsCiAgICAiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3NzVHJhbnNmb3JtZXIoXG4gIGlkOiBzdHJpbmcsXG4gIHN0eWxlczoge1xuICAgIFtrZXk6IHN0cmluZ106IHN0cmluZztcbiAgfVxuKSB7XG4gIGNvbnN0IG91dCA9IGBcbiAgICAuaWlkXyR7aWR9IHtcbiAgICAgICR7T2JqZWN0LmVudHJpZXMoc3R5bGVzKVxuICAgICAgICAuZmlsdGVyKChbLCB2XSkgPT4gdHlwZW9mIHYgPT09IFwic3RyaW5nXCIpXG4gICAgICAgIC5tYXAoKFtrZXksIHZhbHVlXSkgPT4gYCR7a2V5fTogJHt2YWx1ZX1gKVxuICAgICAgICAuam9pbihcIn4gXCIpfVxuICAgIH1cbiAgYFxuICAgIC5yZXBsYWNlKC9cXG4vZywgXCIgXCIpXG4gICAgLnJlcGxhY2UoL1sgXXsyLH0vZywgXCIgXCIpXG4gICAgLnRyaW0oKTtcblxuICByZXR1cm4gb3V0O1xufVxuIiwKICAgICJpbXBvcnQgeyBGRklUeXBlLCBKU0NhbGxiYWNrLCB0eXBlIFBvaW50ZXIgfSBmcm9tIFwiYnVuOmZmaVwiO1xuaW1wb3J0IHR5cGUgV2luZG93IGZyb20gXCIuL3dpbmRvd1wiO1xuaW1wb3J0IHsgdG9DU3RyaW5nIH0gZnJvbSBcIi4uL2ZmaVwiO1xuaW1wb3J0IHsgcmFuZG9tSWQgfSBmcm9tIFwiLi4vdXRpbHMvaWRcIjtcbmltcG9ydCBjc3NUcmFuc2Zvcm1lciBmcm9tIFwiLi4vdXRpbHMvY3NzX3RyYW5zZm9ybWVyXCI7XG5cbmV4cG9ydCB0eXBlIEVsZW1lbnRUYWcgPSBcInZpZXdcIiB8IFwidGV4dFwiIHwgXCJidXR0b25cIiB8IFwiaW5wdXRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWxlbWVudCB7XG4gIHRhZ05hbWU6IEVsZW1lbnRUYWc7XG4gIGlpZDogc3RyaW5nO1xuICBfc3ltYm9sczogTWFwPHN0cmluZywgc3RyaW5nW10+ID0gbmV3IE1hcCgpO1xuXG4gIHByaXZhdGUgX3dpbmRvdzogV2luZG93O1xuXG4gIGNvbnN0cnVjdG9yKHRhZzogRWxlbWVudFRhZywgaWlkOiBzdHJpbmcsIF93aW5kb3c6IFdpbmRvdykge1xuICAgIHRoaXMudGFnTmFtZSA9IHRhZztcbiAgICB0aGlzLmlpZCA9IGlpZDtcblxuICAgIHRoaXMuX3dpbmRvdyA9IF93aW5kb3c7XG4gIH1cblxuICBzdHlsZToge1xuICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgICBzZXRQcm9wZXJ0eTogKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSA9PiB2b2lkO1xuICB9ID0ge1xuICAgIHNldFByb3BlcnR5OiAoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMuc3R5bGVba2V5XSA9IHZhbHVlO1xuXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IGNzc1RyYW5zZm9ybWVyKHRoaXMuaWlkLCB0aGlzLnN0eWxlKTtcblxuICAgICAgdGhpcy5fd2luZG93LmNvcmUuc2V0X3N0eWxlcyhcbiAgICAgICAgdGhpcy5fd2luZG93LmdldENoYW5uZWxQdHIoKSBhcyBQb2ludGVyLFxuICAgICAgICB0b0NTdHJpbmcodGhpcy5paWQpLFxuICAgICAgICB0b0NTdHJpbmcodHJhbnNmb3JtZWQpXG4gICAgICApO1xuICAgIH0sXG4gIH07XG5cbiAgYXBwZW5kQ2hpbGQoY2hpbGQ6IEVsZW1lbnQpIHtcbiAgICB0aGlzLl93aW5kb3cuY29yZS5hcHBlbmRfY2hpbGQoXG4gICAgICB0aGlzLl93aW5kb3cuZ2V0Q2hhbm5lbFB0cigpIGFzIFBvaW50ZXIsXG4gICAgICB0b0NTdHJpbmcodGhpcy5paWQpLFxuICAgICAgdG9DU3RyaW5nKGNoaWxkLmlpZClcbiAgICApO1xuICB9XG5cbiAgc2V0QXR0cmlidXRlKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fd2luZG93LmNvcmUuc2V0X2F0dHJpYnV0ZShcbiAgICAgIHRoaXMuX3dpbmRvdy5nZXRDaGFubmVsUHRyKCkgYXMgUG9pbnRlcixcbiAgICAgIHRvQ1N0cmluZyh0aGlzLmlpZCksXG4gICAgICB0b0NTdHJpbmcodGhpcy50YWdOYW1lKSxcbiAgICAgIHRvQ1N0cmluZyhrZXkpLFxuICAgICAgdG9DU3RyaW5nKHZhbHVlKVxuICAgICk7XG4gIH1cblxuICBnZXRBdHRyaWJ1dGUoa2V5OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzaWQgPSByYW5kb21JZCgpO1xuXG4gICAgdGhpcy5fd2luZG93LmVsZW1lbnRfbGlzdGVuZXJzW3NpZF0gPSAodmFsOiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwidmFsXCIsIHZhbCk7XG4gICAgfTtcblxuICAgIHRoaXMuX3dpbmRvdy5jb3JlLmdldF9hdHRyaWJ1dGUoXG4gICAgICB0aGlzLl93aW5kb3cuZ2V0Q2hhbm5lbFB0cigpIGFzIFBvaW50ZXIsXG4gICAgICB0b0NTdHJpbmcodGhpcy5paWQpLFxuICAgICAgdG9DU3RyaW5nKHRoaXMudGFnTmFtZSksXG4gICAgICB0b0NTdHJpbmcoa2V5KSxcbiAgICAgIHRvQ1N0cmluZyhzaWQpXG4gICAgKTtcbiAgfVxuXG4gIGFkZEV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6ICgpID0+IHZvaWQpIHtcbiAgICBjb25zdCBzeW1ib2xfaWQgPSByYW5kb21JZCgpO1xuXG4gICAgdGhpcy5fd2luZG93LmVsZW1lbnRfbGlzdGVuZXJzW3N5bWJvbF9pZF0gPSBsaXN0ZW5lcjtcblxuICAgIHRoaXMuX3N5bWJvbHMuc2V0KGV2ZW50LCBbLi4uKHRoaXMuX3N5bWJvbHMuZ2V0KGV2ZW50KSB8fCBbXSksIHN5bWJvbF9pZF0pO1xuXG4gICAgdGhpcy5fd2luZG93LmNvcmUuYWRkX2V2ZW50X2xpc3RlbmVyKFxuICAgICAgdGhpcy5fd2luZG93LmdldENoYW5uZWxQdHIoKSBhcyBQb2ludGVyLFxuICAgICAgdG9DU3RyaW5nKHRoaXMuaWlkKSxcbiAgICAgIHRvQ1N0cmluZyhldmVudCksXG4gICAgICB0b0NTdHJpbmcoc3ltYm9sX2lkKVxuICAgICk7XG5cbiAgICByZXR1cm4gc3ltYm9sX2lkO1xuICB9XG5cbiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3ltYm9sX2lkcyA9IHRoaXMuX3N5bWJvbHMuZ2V0KGV2ZW50KTtcblxuICAgIGlmICghc3ltYm9sX2lkcykgcmV0dXJuO1xuXG4gICAgc3ltYm9sX2lkcy5mb3JFYWNoKChzeW1ib2xfaWQpID0+IHtcbiAgICAgIHRoaXMuX3dpbmRvdy5lbGVtZW50X2xpc3RlbmVyc1tzeW1ib2xfaWRdID0gKCkgPT4ge307XG4gICAgICBkZWxldGUgdGhpcy5fd2luZG93LmVsZW1lbnRfbGlzdGVuZXJzW3N5bWJvbF9pZF07XG4gICAgfSk7XG4gIH1cblxuICByZW1vdmUoKSB7XG4gICAgdGhpcy5fd2luZG93LmNvcmUucmVtb3ZlX2VsZW1lbnQoXG4gICAgICB0aGlzLl93aW5kb3cuZ2V0Q2hhbm5lbFB0cigpIGFzIFBvaW50ZXIsXG4gICAgICB0b0NTdHJpbmcodGhpcy5paWQpXG4gICAgKTtcblxuICAgIHRoaXMuX3dpbmRvdy5kb2N1bWVudC5kZWxldGVFbGVtZW50KHRoaXMuaWlkKTtcbiAgfVxufVxuIiwKICAgICJpbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IEVsZW1lbnQsIHsgdHlwZSBFbGVtZW50VGFnIH0gZnJvbSBcIi4vZWxlbWVudFwiO1xuaW1wb3J0IHsgcmFuZG9tSWQgfSBmcm9tIFwiLi4vdXRpbHMvaWRcIjtcbmltcG9ydCB1dGlsIGZyb20gXCJ1dGlsXCI7XG5pbXBvcnQgdHlwZSBXaW5kb3cgZnJvbSBcIi4vd2luZG93XCI7XG5pbXBvcnQgeyB0b0NTdHJpbmcgfSBmcm9tIFwiLi4vZmZpXCI7XG5pbXBvcnQgdHlwZSB7IFBvaW50ZXIgfSBmcm9tIFwiYnVuOmZmaVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEb2N1bWVudCB7XG4gIHByaXZhdGUgX2VsZW1lbnRzOiBNYXA8XG4gICAgc3RyaW5nLFxuICAgIHtcbiAgICAgIHBvaW50ZXI6IG51bWJlcjtcbiAgICAgIGVsZW1lbnQ6IEVsZW1lbnQ7XG4gICAgfVxuICA+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIF93aW5kb3c6IFdpbmRvdztcblxuICBib2R5OiBFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKHdpbmRvdzogV2luZG93KSB7XG4gICAgdGhpcy5fd2luZG93ID0gd2luZG93O1xuXG4gICAgdGhpcy5ib2R5ID0gdGhpcy5fY3JlYXRlRWxlbWVudFdpdGhJZChcInZpZXdcIiwgXCJib2R5XCIsIHRydWUpO1xuICB9XG5cbiAgY3JlYXRlRWxlbWVudCh0YWc6IEVsZW1lbnRUYWcsIGFyZ3M6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fSkge1xuICAgIGNvbnN0IGlpZCA9IHJhbmRvbUlkKCk7XG5cbiAgICByZXR1cm4gdGhpcy5fY3JlYXRlRWxlbWVudFdpdGhJZCh0YWcsIGlpZCwgZmFsc2UsIGFyZ3MpO1xuICB9XG5cbiAgZ2V0RWxlbWVudEJ5SWQoaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50cy5nZXQoaWQpPy5lbGVtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlRWxlbWVudFdpdGhJZChcbiAgICB0YWc6IEVsZW1lbnRUYWcsXG4gICAgaWlkOiBzdHJpbmcsXG4gICAgc2tpcENyZWF0ZSA9IGZhbHNlLFxuICAgIGFyZ3M6IHtcbiAgICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgICB9ID0ge31cbiAgKSB7XG4gICAgaWYgKCFza2lwQ3JlYXRlKVxuICAgICAgdGhpcy5fd2luZG93LmNvcmUuY3JlYXRlX2VsZW1lbnQoXG4gICAgICAgIHRoaXMuX3dpbmRvdy5nZXRDaGFubmVsUHRyKCkgYXMgUG9pbnRlcixcbiAgICAgICAgdG9DU3RyaW5nKHRhZyksXG4gICAgICAgIHRvQ1N0cmluZyhpaWQpLFxuICAgICAgICB0b0NTdHJpbmcoSlNPTi5zdHJpbmdpZnkoYXJncykpXG4gICAgICApO1xuXG4gICAgY29uc3QgZWxlbWVudCA9IG5ldyBFbGVtZW50KHRhZywgaWlkLCB0aGlzLl93aW5kb3cpO1xuXG4gICAgdGhpcy5fZWxlbWVudHMuc2V0KGlpZCwge1xuICAgICAgcG9pbnRlcjogMCxcbiAgICAgIGVsZW1lbnQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuXG4gIGRlbGV0ZUVsZW1lbnQoaWlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9lbGVtZW50cy5kZWxldGUoaWlkKTtcbiAgfVxuXG4gIFt1dGlsLmluc3BlY3QuY3VzdG9tXShfZGVwdGg6IG51bWJlciwgX29wdGlvbnM6IGFueSkge1xuICAgIHJldHVybiBgTmV3dG9uaXVtRG9jdW1lbnQge1xuICBlbGVtZW50czogJHt0aGlzLl9lbGVtZW50cy5zaXplfVxufWA7XG4gIH1cbn1cbiIsCiAgICAiaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBEb2N1bWVudCBmcm9tIFwiLi9kb2N1bWVudFwiO1xuaW1wb3J0IHsgcmFuZG9tSWQgfSBmcm9tIFwiLi4vdXRpbHMvaWRcIjtcbmltcG9ydCB7IGNyZWF0ZUZGSSB9IGZyb20gXCIuLi9mZmlcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2luZG93IHtcbiAgd29ya2VyX3BhdGg6IHN0cmluZyA9IHBhdGguam9pbihpbXBvcnQubWV0YS5kaXJuYW1lLCBcIi4uL3dvcmtlcnMvcnVubmVyXCIpO1xuICBsaWJfcGF0aDogc3RyaW5nID0gcGF0aC5qb2luKFxuICAgIGltcG9ydC5tZXRhLmRpcm5hbWUsXG4gICAgXCIuLi9saWIvbGlibmV3dG9uaXVtXCIgKyAocHJvY2Vzcy5wbGF0Zm9ybSA9PSBcIndpbjMyXCIgPyBcIi5kbGxcIiA6IFwiLnNvXCIpXG4gICk7XG5cbiAgcHJpdmF0ZSBfd29ya2VyOiBXb3JrZXI7XG4gIHByaXZhdGUgX2lkOiBzdHJpbmc7XG4gIHByaXZhdGUgX2NoYW5uZWxfcHRyOiBudW1iZXIgPSAtMTtcbiAgY29yZSA9IGNyZWF0ZUZGSSh0aGlzLmxpYl9wYXRoKTtcbiAgdGl0bGU6IHN0cmluZztcbiAgaWNvbjogc3RyaW5nO1xuICBkb2N1bWVudDogRG9jdW1lbnQ7XG5cbiAgbGlzdGVuZXJzOiB7XG4gICAgW2tleTogc3RyaW5nXTogRnVuY3Rpb25bXTtcbiAgfSA9IHtcbiAgICByZWFkeTogW10sXG4gIH07XG5cbiAgZWxlbWVudF9saXN0ZW5lcnM6IHtcbiAgICBba2V5OiBzdHJpbmddOiBGdW5jdGlvbjtcbiAgfSA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKHRpdGxlOiBzdHJpbmcsIGljb246IHN0cmluZykge1xuICAgIHRoaXMuX3dvcmtlciA9IG5ldyBXb3JrZXIodGhpcy53b3JrZXJfcGF0aCk7XG4gICAgdGhpcy5faWQgPSByYW5kb21JZCgpO1xuICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICB0aGlzLmljb24gPSBpY29uO1xuICAgIHRoaXMuZG9jdW1lbnQgPSBuZXcgRG9jdW1lbnQodGhpcyk7XG4gIH1cblxuICBydW4oKSB7XG4gICAgdGhpcy5fd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgIGxpYl9wYXRoOiB0aGlzLmxpYl9wYXRoLFxuICAgICAgaWQ6IHRoaXMuX2lkLFxuICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICBpY29uOiB0aGlzLmljb24sXG4gICAgfSk7XG5cbiAgICB0aGlzLl93b3JrZXIub25tZXNzYWdlID0gKGUpID0+IHtcbiAgICAgIGlmIChlLmRhdGEuZSA9PT0gXCJjbG9zZVwiKSB0aGlzLl93b3JrZXIudGVybWluYXRlKCk7XG4gICAgICBpZiAoZS5kYXRhLmUgPT09IFwicmVhZHlcIikge1xuICAgICAgICB0aGlzLl9jaGFubmVsX3B0ciA9IGUuZGF0YS5jaGFubmVsX3B0cjtcbiAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwicmVhZHlcIik7XG4gICAgICB9XG4gICAgICBpZiAoZS5kYXRhLmUgPT09IFwiZXZlbnRcIikge1xuICAgICAgICBjb25zdCBsaXN0ZW5lciA9XG4gICAgICAgICAgdGhpcy5lbGVtZW50X2xpc3RlbmVyc1tcbiAgICAgICAgICAgIGUuZGF0YS5zeW1ib2xfaWQuc3RhcnRzV2l0aChcIiEhXCIpXG4gICAgICAgICAgICAgID8gZS5kYXRhLmlpZC5zcGxpdChcIiEhXCIpWzBdXG4gICAgICAgICAgICAgIDogZS5kYXRhLnN5bWJvbF9pZFxuICAgICAgICAgIF07XG5cbiAgICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuO1xuXG4gICAgICAgIGlmIChlLmRhdGEuc3ltYm9sX2lkLnN0YXJ0c1dpdGgoXCIhIVwiKSkge1xuICAgICAgICAgIGxpc3RlbmVyKGUuZGF0YS5paWQuc3BsaXQoXCIhIVwiKS5zbGljZSgxKS5qb2luKFwiISFcIikpO1xuXG4gICAgICAgICAgZGVsZXRlIHRoaXMuZWxlbWVudF9saXN0ZW5lcnNbZS5kYXRhLnN5bWJvbF9pZF07XG5cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsaXN0ZW5lcigpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBvbihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pIHtcbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2V2ZW50XSkgdGhpcy5saXN0ZW5lcnNbZXZlbnRdID0gW107XG5cbiAgICB0aGlzLmxpc3RlbmVyc1tldmVudF0ucHVzaChsaXN0ZW5lcik7XG4gIH1cblxuICBwcml2YXRlIF9maXJlRXZlbnQoZXZlbnQ6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcbiAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIHRoaXMubGlzdGVuZXJzW2V2ZW50XSkge1xuICAgICAgbGlzdGVuZXIoLi4uYXJncyk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2hhbm5lbFB0cigpIHtcbiAgICBpZiAodGhpcy5fY2hhbm5lbF9wdHIgPT09IC0xKSB0aHJvdyBuZXcgRXJyb3IoXCJXaW5kb3cgaXMgbm90IHJlYWR5IHlldFwiKTtcblxuICAgIHJldHVybiB0aGlzLl9jaGFubmVsX3B0cjtcbiAgfVxufVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjtBQUFBLGlCQUFTLGFBQVEsZ0JBRVYsU0FBUyxDQUFTLENBQUMsRUFBYyxDQUN0QyxNQUFRLFdBQVksRUFBTyxFQUFNLENBQy9CLFdBQVksQ0FDVixLQUFNLENBQUMsRUFDUCxRQUFTLEVBQVEsSUFDbkIsRUFDQSxJQUFLLENBQ0gsS0FBTSxDQUFDLEVBQ1AsUUFBUyxFQUFRLElBQ25CLEVBQ0EsY0FBZSxDQUNiLEtBQU0sQ0FDSixFQUFRLFFBQ1IsRUFBUSxRQUNSLEVBQVEsUUFDUixFQUFRLFFBQ1YsRUFDQSxRQUFTLEVBQVEsR0FDbkIsRUFDQSxlQUFnQixDQUNkLEtBQU0sQ0FBQyxFQUFRLElBQUssRUFBUSxRQUFTLEVBQVEsUUFBUyxFQUFRLE9BQU8sRUFDckUsUUFBUyxFQUFRLElBQ25CLEVBQ0EsYUFBYyxDQUNaLEtBQU0sQ0FBQyxFQUFRLElBQUssRUFBUSxRQUFTLEVBQVEsR0FBRyxFQUNoRCxRQUFTLEVBQVEsSUFDbkIsRUFDQSxjQUFlLENBQ2IsS0FBTSxDQUNKLEVBQVEsSUFDUixFQUFRLFFBQ1IsRUFBUSxRQUNSLEVBQVEsUUFDUixFQUFRLE9BQ1YsRUFDQSxRQUFTLEVBQVEsSUFDbkIsRUFDQSxtQkFBb0IsQ0FDbEIsS0FBTSxDQUFDLEVBQVEsSUFBSyxFQUFRLFFBQVMsRUFBUSxRQUFTLEVBQVEsT0FBTyxFQUNyRSxRQUFTLEVBQVEsSUFDbkIsRUFDQSxlQUFnQixDQUNkLEtBQU0sQ0FBQyxFQUFRLElBQUssRUFBUSxPQUFPLEVB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LFFBQVMsbUJBQW1CLEVBQ3hFLFNBQW1CLEVBQUssS0FDdEIsWUFBWSxRQUNaLHVCQUF5QixRQUFRLFVBQVksUUFBVSxPQUFTLE1BQ2xFLEVBRVEsUUFDQSxJQUNBLGFBQXVCLEdBQy9CLEtBQU8sRUFBVSxLQUFLLFFBQVEsRUFDOUIsTUFDQSxLQUNBLFNBRUEsVUFFSSxDQUNGLE1BQU8sQ0FBQyxDQUNWLEVBRUEsa0JBRUksQ0FBQyxFQUVMLFdBQVcsQ0FBQyxFQUFlLEVBQWMsQ0FDdkMsS0FBSyxRQUFVLElBQUksT0FBTyxLQUFLLFdBQVcsRUFDMUMsS0FBSyxJQUFNLEVBQVMsRUFDcEIsS0FBSyxNQUFRLEVBQ2IsS0FBSyxLQUFPLEVBQ1osS0FBSyxTQUFXLElBQUksRUFBUyxJQUFJLEVBR25DLEdBQUcsRUFBRyxDQUNKLEtBQUssUUFBUSxZQUFZLENBQ3ZCLFNBQVUsS0FBSyxTQUNmLEdBQUksS0FBSyxJQUNULE1BQU8sS0FBSyxNQUNaLEtBQU0sS0FBSyxJQUNiLENBQUMsRUFFRCxLQUFLLFFBQVEsVUFBWSxDQUFDLElBQU0sQ0FDOUIsR0FBSSxFQUFFLEtBQUssSUFBTSxRQUFTLEtBQUssUUFBUSxVQUFVLEVBQ2pELEdBQUksRUFBRSxLQUFLLElBQU0sUUFDZixLQUFLLGFBQWUsRUFBRSxLQUFLLFlBQzNCLEtBQUssV0FBVyxPQUFPLEVBRXpCLEdBQUksRUFBRSxLQUFLLElBQU0sUUFBUyxDQUN4QixNQUFNLEVBQ0osS0FBSyxrQkFDSCxFQUFFLEtBQUssVUFBVSxXQUFXLElBQUksRUFDNUIsRUFBRSxLQUFLLElBQUksTUFBTSxJQUFJLEVBQUUsR0FDdkIsRUFBRSxLQUFLLFdBR2YsSUFBSyxFQUFVLE9BRWYsR0FBSSxFQUFFLEtBQUssVUFBVSxXQUFXLElBQUksRUFBRyxDQUNyQyxFQUFTLEVBQUUsS0FBSyxJQUFJLE1BQU0sSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLFNBRTVDLEtBQUssa0JBQWtCLEVBQUUsS0FBSyxXQUVyQyxPQUdGLEVBQVMsSUFLZixFQUFFLENBQUMsRUFBZSxFQUFvQixDQUNwQyxJQUFLLEtBQUssVUFBVSxHQUFRLEtBQUssVUFBVSxHQUFTLENBQUMsRUFFckQsS0FBSyxVQUFVLEdBQU8sS0FBSyxDQUFRLEVBRzdCLFVBQVUsQ0FBQyxLQUFrQixFQUFhLENBQ2hELFFBQVcsS0FBWSxLQUFLLFVBQVUsR0FDcEMsRUFBUyxHQUFHLENBQUksRUFJcEIsYUFBYSxFQUFHLENBQ2QsR0FBSSxLQUFLLGVBQWlCLEdBQUksTUFBTSxJQUFJLE1BQU0seUJBQXlCLEVBRXZFLE9BQU8sS0FBSyxhQUVoQiIsCiAgImRlYnVnSWQiOiAiQzgyNzJCMUI3RTA2M0FBNTY0NzU2RTIxNjQ3NTZFMjEiLAogICJuYW1lcyI6IFtdCn0=
